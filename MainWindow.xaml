<hc:Window x:Class="SpotiffyWidget.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:hc="https://handyorg.github.io/handycontrol"
        mc:Ignorable="d"
        Title="Spotify Desktop Widget" 
        WindowStartupLocation="CenterScreen"
        ShowTitle="True"
        Height="560" 
        Width="820">
    <hc:Window.NonClientAreaContent>
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width ="10*"/>
                <ColumnDefinition Width ="20*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="1*" />
                <RowDefinition Height="3*" />
            </Grid.RowDefinitions>
            <StackPanel Height="29">
                <Menu HorizontalAlignment="Left">
                    <MenuItem Header="Header1">
                        <MenuItem Header="Header1"/>
                        <MenuItem Header="Header2"/>
                    </MenuItem>
                    <MenuItem Header="Header2">
                        <MenuItem Header="Header1"/>
                        <MenuItem Header="Header2"/>
                    </MenuItem>
                </Menu>
            </StackPanel>

            
             <Popup AllowsTransparency="True" Grid.Column="1" PlacementTarget="{Binding ElementName=ButtonConfig}" HorizontalOffset="-35" Name="PopupConfig" VerticalOffset="6" StaysOpen="False">
                <Border Background="{DynamicResource SecondaryRegionBrush}" CornerRadius="4" Margin="16" Effect="{StaticResource EffectShadow2}">
                    <StackPanel Button.Click="ButtonSkins_OnClick">
                        <hc:Divider Width="200" Margin="0,10" Content="Application Theme"/>
                        <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                            <Button Tag="{x:Static hc:ApplicationTheme.Light}" Style="{StaticResource ButtonCustom}">
                                <Border Background="White" Width="32" Height="21" CornerRadius="2" BorderThickness="1" BorderBrush="{DynamicResource BorderBrush}"/>
                            </Button>
                            <Button Tag="{x:Static hc:ApplicationTheme.Dark}" Style="{StaticResource ButtonCustom}" Margin="10,0,0,0">
                                <Border Background="Black" Width="32" Height="21" CornerRadius="2" BorderThickness="1" BorderBrush="{DynamicResource BorderBrush}"/>
                            </Button>
                        </StackPanel>

                        <hc:Divider Width="200" Margin="0,10" Content="Accent Color"/>
                        <StackPanel Margin="0,0,0,10" HorizontalAlignment="Center" Orientation="Horizontal">
                            <Button Tag="{Binding ElementName=primaryBorder, Path=Background}" Style="{StaticResource ButtonCustom}">
                                <Border Name="primaryBorder" Background="#2196F3" Width="32" Height="21" CornerRadius="2" BorderThickness="1" BorderBrush="{DynamicResource BorderBrush}"/>
                            </Button>
                            <Button Tag="{Binding ElementName=warningBorder, Path=Background}" Style="{StaticResource ButtonCustom}" Margin="10,0,0,0">
                                <Border Name="warningBorder" Background="{DynamicResource WarningBrush}" Width="32" Height="21" CornerRadius="2" BorderThickness="1" BorderBrush="{DynamicResource BorderBrush}"/>
                            </Button>
                            <Button Tag="{Binding ElementName=violetBorder, Path=Background}" Style="{StaticResource ButtonCustom}" Margin="10,0,0,0">
                                <Border Name="violetBorder" Background="#9C27B0" Width="32" Height="21" CornerRadius="2" BorderThickness="1" BorderBrush="{DynamicResource BorderBrush}"/>
                            </Button>
                            <Button Tag="{Binding ElementName=successBorder, Path=Background}" Style="{StaticResource ButtonCustom}" Margin="10,0,0,0">
                                <Border Name="successBorder" Background="{DynamicResource SuccessBrush}" Width="32" Height="21" CornerRadius="2" BorderThickness="1" BorderBrush="{DynamicResource BorderBrush}"/>
                            </Button>
                        </StackPanel>
                        <Button HorizontalAlignment="Stretch" Tag="Picker" Content="More Colors" Margin="10"/>
                    </StackPanel>
                </Border>
            </Popup>
        </Grid>
    </hc:Window.NonClientAreaContent>
    <Grid>
        <!-- Subtle blurred gradient background -->
        <Grid.Background>
            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#283248" Offset="0"/>
                <GradientStop Color="#1B2437" Offset="0.5"/>
                <GradientStop Color="#122035" Offset="1"/>
            </LinearGradientBrush>
        </Grid.Background>

        <!-- Keep hidden access button to preserve code-behind references -->
        <Button Click="AccessButton_Click" Name="AccessButton" Visibility="Collapsed"/>

        <!-- Main player card -->
        <Border Margin="24" CornerRadius="22" Background="{DynamicResource RegionBrush}" Effect="{StaticResource EffectShadow2}">
            <Grid Margin="20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="12"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header area -->
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="3*"/>
                        <ColumnDefinition Width="2*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Left: album and track info -->
                    <Grid Grid.Column="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Album avatar -->
                        <Border Width="96" Height="96" CornerRadius="48" VerticalAlignment="Top">
                            <Border.Background>
                                <RadialGradientBrush GradientOrigin="0.3,0.3" RadiusX="1.0" RadiusY="1.0">
                                    <GradientStop Color="#79E0FF" Offset="0"/>
                                    <GradientStop Color="#E69CCF" Offset="0.5"/>
                                    <GradientStop Color="#001018" Offset="1"/>
                                </RadialGradientBrush>
                            </Border.Background>
                            <TextBlock Text="Dive In" FontWeight="Bold" FontSize="18" Foreground="Black" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>

                        <!-- spacer -->
                        <Grid Grid.Column="1"/>

                        <!-- Track texts and progress -->
                        <StackPanel Grid.Column="2" VerticalAlignment="Center">
                            <TextBlock Text="Oxygen" FontSize="22" FontWeight="Bold" Foreground="{DynamicResource PrimaryTextBrush}"/>
                            <TextBlock Text="'The Helio Sequence" Margin="0,2,0,0" Foreground="{DynamicResource SecondaryTextBrush}"/>
                            <TextBlock Text="Divin" Margin="0,0,0,10" Foreground="{DynamicResource SecondaryTextBrush}"/>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="8"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Slider Grid.Column="0" Minimum="0" Maximum="210" Value="45" Height="6" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Grid.Column="1" Text="0:45" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                <TextBlock Grid.Column="3" Text="3:30" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextBrush}"/>
                            </Grid>

                            <!-- Transport controls -->
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,14,0,0">
                                <Button Style="{StaticResource ButtonIcon}" Width="44" Height="44" Margin="0,0,10,0" Content="⏮"/>
                                <Button Style="{StaticResource ButtonIcon}" Width="48" Height="48" Margin="0,0,10,0" Content="⏸"/>
                                <Button Style="{StaticResource ButtonIcon}" Width="44" Height="44" Content="⏭"/>
                            </StackPanel>
                        </StackPanel>
                    </Grid>

                    <!-- Right: search box -->
                    <Grid Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Top">
                        <Border CornerRadius="12" Background="#19FFFFFF" Padding="10" Effect="{StaticResource EffectShadow2}">
                            <Grid>
                                <TextBlock Text="" FontFamily="Segoe MDL2 Assets" VerticalAlignment="Center" Margin="8,0,0,0" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                <TextBox Margin="24,0,0,0" MinWidth="260" BorderThickness="0" Background="Transparent" Foreground="{DynamicResource PrimaryTextBrush}"
                                         hc:InfoElement.Placeholder="Search Song or Artist..."/>
                            </Grid>
                        </Border>
                    </Grid>
                </Grid>

                <!-- Spacer row -->
                <Grid Grid.Row="1"/>

                <!-- Playlist list -->
                <ListBox x:Name="TracksListBox" Grid.Row="2" Background="Transparent" BorderThickness="0">
                    <ListBox.Resources>
                        <!-- Reduce selection chrome -->
                        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="#334B81"/>
                    </ListBox.Resources>
                    <ListBoxItem>
                        <Grid Margin="0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Border Width="48" Height="48" CornerRadius="8" Margin="0,0,12,0">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#FF5FE7" Offset="0"/>
                                        <GradientStop Color="#FFAE9E" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                            </Border>
                            <TextBlock Grid.Column="1" VerticalAlignment="Center" Text="Discover Weekly" FontSize="16" Foreground="{DynamicResource PrimaryTextBrush}"/>
                            <Button Grid.Column="2" Style="{StaticResource ButtonIcon}" Width="32" Height="32" Content="❤"/>
                        </Grid>
                    </ListBoxItem>
                    <ListBoxItem>
                        <Grid Margin="0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Border Width="48" Height="48" CornerRadius="8" Margin="0,0,12,0">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#FF4466" Offset="0"/>
                                        <GradientStop Color="#FF9B2F" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                            </Border>
                            <TextBlock Grid.Column="1" VerticalAlignment="Center" Text="Release Radar" FontSize="16" Foreground="{DynamicResource PrimaryTextBrush}"/>
                            <TextBlock Grid.Column="2" VerticalAlignment="Center" Text="⋯" FontSize="20" Margin="0,0,8,0" Foreground="{DynamicResource SecondaryTextBrush}"/>
                        </Grid>
                    </ListBoxItem>
                    <ListBoxItem>
                        <Grid Margin="0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Border Width="48" Height="48" CornerRadius="8" Margin="0,0,12,0">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#6980FF" Offset="0"/>
                                        <GradientStop Color="#7FE0FF" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                            </Border>
                            <TextBlock Grid.Column="1" VerticalAlignment="Center" Text="Liked Songs" FontSize="16" Foreground="{DynamicResource PrimaryTextBrush}"/>
                            <Button Grid.Column="2" Style="{StaticResource ButtonIcon}" Width="32" Height="32" Content="❤"/>
                        </Grid>
                    </ListBoxItem>
                    <ListBoxItem>
                        <Grid Margin="0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Border Width="48" Height="48" CornerRadius="8" Margin="0,0,12,0">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#B3E0FF" Offset="0"/>
                                        <GradientStop Color="#FAD6B2" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                            </Border>
                            <TextBlock Grid.Column="1" VerticalAlignment="Center" Text="Chill Mix" FontSize="16" Foreground="{DynamicResource PrimaryTextBrush}"/>
                            <Button Grid.Column="2" Style="{StaticResource ButtonIcon}" Width="32" Height="32" Content="❤"/>
                        </Grid>
                    </ListBoxItem>
                </ListBox>
            </Grid>
        </Border>
    </Grid>
</hc:Window>
