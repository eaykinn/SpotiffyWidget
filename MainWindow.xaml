<hc:Window x:Class="SpotiffyWidget.MainWindow"
           xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
           xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
           xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
           xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
           xmlns:hc="https://handyorg.github.io/handycontrol"
           xmlns:cards="clr-namespace:SpotiffyWidget.Cards"
           mc:Ignorable="d"
           Title="Spotify Desktop Widget"
           WindowStartupLocation="CenterScreen"
           ShowTitle="True"
           Height="770"
           Width="450"
           MinWidth="400"
           MinHeight="470"
           WindowStyle="None">
    <hc:Window.NonClientAreaContent>
        <Grid>


            <Button Grid.Row="0" Click="ChangeTheme" HorizontalAlignment="Left" Margin="20,3,0,3"
                    Style="{StaticResource ButtonIcon}" Foreground="{DynamicResource PrimaryTextBrush}"
                    hc:IconElement.Geometry="{StaticResource ConfigGeometry}" />
            <Popup AllowsTransparency="True" Grid.Column="1" PlacementTarget="{Binding ElementName=ButtonConfig}"
                   HorizontalOffset="-35" x:Name="PopupConfig" VerticalOffset="6" StaysOpen="False">
                <Border Background="{DynamicResource SecondaryRegionBrush}" CornerRadius="4" Margin="16"
                        Effect="{StaticResource EffectShadow2}">
                    <StackPanel Button.Click="ButtonSkins_OnClick">
                        <hc:Divider Width="200" Margin="0,10" Content="Application Theme" />
                        <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                            <Button Tag="{x:Static hc:ApplicationTheme.Light}" Style="{StaticResource ButtonCustom}">
                                <Border Background="White" Width="32" Height="21" CornerRadius="2" BorderThickness="1"
                                        BorderBrush="{DynamicResource BorderBrush}" />
                            </Button>
                            <Button Tag="{x:Static hc:ApplicationTheme.Dark}" Style="{StaticResource ButtonCustom}"
                                    Margin="10,0,0,0">
                                <Border Background="Black" Width="32" Height="21" CornerRadius="2" BorderThickness="1"
                                        BorderBrush="{DynamicResource BorderBrush}" />
                            </Button>
                        </StackPanel>

                        <hc:Divider Width="200" Margin="0,10" Content="Accent Color" />
                        <StackPanel Margin="0,0,0,10" HorizontalAlignment="Center" Orientation="Horizontal">
                            <Button Tag="{Binding ElementName=primaryBorder, Path=Background}"
                                    Style="{StaticResource ButtonCustom}">
                                <Border Name="primaryBorder" Background="#2196F3" Width="32" Height="21"
                                        CornerRadius="2" BorderThickness="1"
                                        BorderBrush="{DynamicResource BorderBrush}" />
                            </Button>
                            <Button Tag="{Binding ElementName=warningBorder, Path=Background}"
                                    Style="{StaticResource ButtonCustom}" Margin="10,0,0,0">
                                <Border Name="warningBorder" Background="{DynamicResource WarningBrush}" Width="32"
                                        Height="21" CornerRadius="2" BorderThickness="1"
                                        BorderBrush="{DynamicResource BorderBrush}" />
                            </Button>
                            <Button Tag="{Binding ElementName=violetBorder, Path=Background}"
                                    Style="{StaticResource ButtonCustom}" Margin="10,0,0,0">
                                <Border Name="violetBorder" Background="#9C27B0" Width="32" Height="21"
                                        CornerRadius="2" BorderThickness="1"
                                        BorderBrush="{DynamicResource BorderBrush}" />
                            </Button>
                            <Button Tag="{Binding ElementName=successBorder, Path=Background}"
                                    Style="{StaticResource ButtonCustom}" Margin="10,0,0,0">
                                <Border Name="successBorder" Background="{DynamicResource SuccessBrush}" Width="32"
                                        Height="21" CornerRadius="2" BorderThickness="1"
                                        BorderBrush="{DynamicResource BorderBrush}" />
                            </Button>
                        </StackPanel>
                        <Button HorizontalAlignment="Stretch" Tag="Picker" Content="More Colors" Margin="10" />
                    </StackPanel>
                </Border>
            </Popup>
        </Grid>

    </hc:Window.NonClientAreaContent>
    <hc:Window.Resources>
        <Style x:Key="DynamicHeightListBoxItem" TargetType="ListBoxItem">
            <Setter Property="Padding" Value="0" />
            <Setter Property="Margin" Value="10,2,2,2" />
            <Setter Property="MaxHeight" Value="110" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                MaxHeight="{TemplateBinding MaxHeight}"
                                Padding="{TemplateBinding Padding}"
                                CornerRadius="5"
                                SnapsToDevicePixels="true">
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="ViewStates">
                                    <VisualState x:Name="NormalView">
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="Bd"
                                                             Storyboard.TargetProperty="MaxHeight" To="110"
                                                             Duration="0:0:0.2" />
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="CompactView">
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="Bd"
                                                             Storyboard.TargetProperty="MaxHeight" To="65"
                                                             Duration="0:0:0.2" />
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"
                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <!-- Kural 1: Öğe seçili DEĞİLKEN fare üzerine gelirse, gri yap -->
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsMouseOver" Value="True" />
                                    <Condition Property="IsSelected" Value="False" />
                                </MultiTrigger.Conditions>
                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource SecondaryRegionBrush}" />
                            </MultiTrigger>

                            <!-- Kural 2: Öğe seçili ise (fare üzerinde olsun veya olmasın), ana tema rengi yap -->
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsSelected" Value="True" />
                                </MultiTrigger.Conditions>
                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource PrimaryBrush}" />
                            </MultiTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </hc:Window.Resources>
    <Border Padding="10">

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1*" />

            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="1" />
                <RowDefinition Height="20*" MinHeight="200" />
                <RowDefinition Height="1*" />
                <RowDefinition Height="40*" MinHeight="180" />
            </Grid.RowDefinitions>

            <hc:TransitioningContentControl x:Name="LoadingPanel" Visibility="Collapsed" TransitionMode="Fade"
                                            Grid.Column="0" Grid.Row="3" Panel.ZIndex="11">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <hc:LoadingCircle Width="30" Height="30" DotSpeed="4" DotCount="5" />
                    <TextBlock Text="Loading..."
                               Margin="0,0,0,0"
                               FontSize="14"
                               HorizontalAlignment="Center" />
                </StackPanel>
            </hc:TransitioningContentControl>

            <!--<Button Grid.Column="1" Grid.Row="0" Click="CancelClick" Name="Cancel" Style="{StaticResource ButtonIcon}" Foreground="{DynamicResource PrimaryTextBrush}" hc:IconElement.Geometry="{StaticResource CloseGeometry}"/>-->

            <cards:PlayerCard x:Name="PlayerCard" Grid.Column="0" Grid.Row="1" />
            <Border Grid.Row="3" Grid.Column="0" CornerRadius="5" Style="{StaticResource BorderRegion}">

                <hc:TabControl x:Name="MainTabs" IsScrollable="True" ShowScrollButton="True"
                               Style="{StaticResource  TabControlInLine}" TabItemWidth="120" TabItemHeight="25"
                               Grid.Row="3" Grid.Column="0" HorizontalContentAlignment="Stretch"
                               SelectionChanged="TabControl_SelectionChanged">
                    <hc:TabItem Header="Tracks">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="1*" MinHeight="40" />
                                <RowDefinition Height="1*" MinHeight="30"/>
                                <RowDefinition Height="10*" />
                            </Grid.RowDefinitions>

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="1*" />
                                <ColumnDefinition Width="1*" />
                                <ColumnDefinition Width="1*" />
                                <ColumnDefinition Width="1*" />
                                <ColumnDefinition Width="1*" />
                                <ColumnDefinition Width="1*" />

                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Row="0" Grid.ColumnSpan="3" Grid.Column="0" HorizontalAlignment="Left"
                                        VerticalAlignment="Center" Margin="10,3,10,3" Orientation="Horizontal">
                                <hc:ButtonGroup x:Name="TrackRadioButton" Style="{StaticResource ButtonGroupSolid}">
                                    <RadioButton x:Name="MyTracks" FontSize="11" Padding="5,0,5,0"
                                                 Click="TracksRadioButton_Click">
                                        My Tracks
                                    </RadioButton>
                                    <RadioButton x:Name="MyTopTracks" FontSize="11" Padding="5,0,5,0"
                                                 Click="TracksRadioButton_Click">
                                        My Top Tracks
                                    </RadioButton>

                                </hc:ButtonGroup>

                            </StackPanel>

                            <StackPanel Grid.Row="0" Grid.Column="3" HorizontalAlignment="Right"
                                        VerticalAlignment="Center" Orientation="Horizontal" Grid.ColumnSpan="4"
                                        Margin="10,3,10,3">
                                <hc:SearchBar x:Name="TrackSearchBar" MinWidth="100" VerticalAlignment="Center"
                                              Padding="5,0,5,0" Margin="10,0,0,0"
                                              SearchStarted="TrackSearchBar_SearchStarted" />
                                <Button x:Name="TrackChangeView" Tag="TracksListBox"  Click="ChangeView_Click" Style="{StaticResource ButtonPrimary}" Foreground="{DynamicResource PrimaryTextBrush}" hc:IconElement.Geometry="{StaticResource ListIcon}"
                                        Margin="5,3,0,3">
                                
                                </Button>
                            </StackPanel>
                            <Button x:Name="TrackPlayButton" Padding="0,0,0,0" HorizontalAlignment="Left" Margin="10,0,0,0" Grid.Row="1" Style="{StaticResource ButtonIcon}" Foreground="{DynamicResource PrimaryTextBrush}" hc:IconElement.Geometry="{StaticResource PlayIcon}" Click="TrackPlayButton_Click"/>
                            <ListBox BorderBrush="Transparent" Grid.Row="2" Grid.ColumnSpan="6" Margin="0,0,0,0"
                                     Padding="0,0,0,0" HorizontalContentAlignment="Stretch" x:Name="TracksListBox"
                                     MouseDoubleClick="TracksDoubleClick"
                                     ItemContainerStyle="{StaticResource DynamicHeightListBoxItem}" />
                        </Grid>
                    </hc:TabItem>

                    <hc:TabItem Header="Artists">
                               <!-- Sayfa Gösterici -->
                        <Frame x:Name="MainArtistsFrame" NavigationUIVisibility="Hidden"/>
                      
                    </hc:TabItem>

                    <hc:TabItem Header="PlayLists">
                        <!-- Sayfa Gösterici -->
                        <Frame x:Name="MainPlayListsFrame" NavigationUIVisibility="Hidden"/>

                    </hc:TabItem>
                </hc:TabControl>

            </Border>


        </Grid>
    </Border>
</hc:Window>