<Page x:Class="SpotiffyWidget.Pages.TabsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:hc="https://handyorg.github.io/handycontrol"
      xmlns:local="clr-namespace:SpotiffyWidget.Pages"
      mc:Ignorable="d" 
  
      d:DesignHeight="450" d:DesignWidth="800"
      Title="TabsPage">
    <Page.Resources>
        <Style x:Key="DynamicHeightListBoxItem" TargetType="ListBoxItem">
            <Setter Property="Padding" Value="0" />
            <Setter Property="Margin" Value="10,2,2,2" />
            <Setter Property="MaxHeight" Value="110" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="Bd"
                              Background="{TemplateBinding Background}"
                              BorderBrush="{TemplateBinding BorderBrush}"
                              BorderThickness="{TemplateBinding BorderThickness}"
                              MaxHeight="{TemplateBinding MaxHeight}"
                              Padding="{TemplateBinding Padding}"
                              CornerRadius="5"
                              SnapsToDevicePixels="true">
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="ViewStates">
                                    <VisualState x:Name="NormalView">
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="Bd"
                                                           Storyboard.TargetProperty="MaxHeight" To="110"
                                                           Duration="0:0:0.2" />
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="CompactView">
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="Bd"
                                                           Storyboard.TargetProperty="MaxHeight" To="65"
                                                           Duration="0:0:0.2" />
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"
                                            VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <!-- Kural 1: Öğe seçili DEĞİLKEN fare üzerine gelirse, gri yap -->
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsMouseOver" Value="True" />
                                    <Condition Property="IsSelected" Value="False" />
                                </MultiTrigger.Conditions>
                                <Setter TargetName="Bd" Property="Background" Value="#10000000" />
                            </MultiTrigger>

                            <!-- Kural 2: Öğe seçili ise (fare üzerinde olsun veya olmasın), ana tema rengi yap -->
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsSelected" Value="True" />
                                </MultiTrigger.Conditions>
                                <Setter TargetName="Bd" Property="Background" Value="{DynamicResource PrimaryBrush}" />
                            </MultiTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    <Border Background="Transparent" CornerRadius="5">
        
        <Grid>
            <hc:TabControl x:Name="MainTabs"  IsScrollable="True" ShowScrollButton="True" BorderThickness="0" Background="Transparent"
                   Style="{StaticResource  TabControlInLine}" TabItemWidth="120" TabItemHeight="25"
                   Grid.Row="3" Grid.Column="0" HorizontalContentAlignment="Stretch"
                   SelectionChanged="TabControl_SelectionChanged"
                          >
                <hc:TabItem Header="Tracks"  Background="Transparent">
                    <hc:TransitioningContentControl TransitionMode="Right2LeftWithFade">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="1*" MinHeight="40" />
                                <RowDefinition Height="1*" MinHeight="30"/>
                                <RowDefinition Height="10*" />
                            </Grid.RowDefinitions>

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="1*" />
                                <ColumnDefinition Width="1*" />
                                <ColumnDefinition Width="1*" />
                                <ColumnDefinition Width="1*" />
                                <ColumnDefinition Width="1*" />
                                <ColumnDefinition Width="1*" />

                            </Grid.ColumnDefinitions>

                            <hc:TransitioningContentControl x:Name="LoadingPanel" Visibility="Collapsed" TransitionMode="Fade"
                                                Grid.Column="0" Grid.Row="3" Panel.ZIndex="11" Grid.ColumnSpan="6">
                                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <hc:LoadingCircle Width="30" Height="30" DotSpeed="4" DotCount="5" />
                                    <TextBlock Text="Loading..."
                                   Margin="0,0,0,0"
                                   FontSize="14"
                                   HorizontalAlignment="Center" Foreground="{DynamicResource PrimaryTextBrush}"/>
                                </StackPanel>
                            </hc:TransitioningContentControl>
                            <StackPanel Background="Transparent" Grid.Row="0" Grid.ColumnSpan="3" Grid.Column="0" HorizontalAlignment="Left"
                            VerticalAlignment="Center" Margin="10,3,10,3" Orientation="Horizontal">
                                <hc:ButtonGroup x:Name="TrackRadioButton" Style="{StaticResource ButtonGroupSolid}">
                                    <RadioButton x:Name="MyTracks" FontSize="11" Padding="5,0,5,0"
                                     Click="TracksRadioButton_Click">
                                        My Tracks
                                    </RadioButton>
                                    <RadioButton x:Name="MyTopTracks" FontSize="11" Padding="5,0,5,0"
                                     Click="TracksRadioButton_Click">
                                        My Top Tracks
                                    </RadioButton>

                                </hc:ButtonGroup>

                            </StackPanel>

                            <StackPanel Grid.Row="0" Grid.Column="3" HorizontalAlignment="Right" Background="Transparent"
                            VerticalAlignment="Center" Orientation="Horizontal" Grid.ColumnSpan="4"
                            Margin="10,3,10,3">
                                <hc:SearchBar x:Name="TrackSearchBar" MinWidth="100" VerticalAlignment="Center" BorderBrush="{DynamicResource PrimaryBrush}" Background="Transparent"
                                  Padding="5,0,5,0" Margin="10,0,0,0"
                                  SearchStarted="TrackSearchBar_SearchStarted" >
                                </hc:SearchBar>
                                <Button x:Name="TrackChangeView" Tag="TracksListBox"  Click="ChangeView_Click" Style="{StaticResource ButtonPrimary}" Foreground="{DynamicResource PrimaryTextBrush}" hc:IconElement.Geometry="{StaticResource ListIcon}"
                            Margin="5,3,0,3">

                                </Button>
                            </StackPanel>
                            <Button x:Name="TrackPlayButton" Padding="0,0,0,0" HorizontalAlignment="Left" Margin="10,0,0,0" Grid.Row="1" Style="{StaticResource ButtonIcon}" Foreground="{DynamicResource PrimaryTextBrush}" hc:IconElement.Geometry="{StaticResource PlayIcon}" Click="TrackPlayButton_Click"/>
                            <ListBox  Background="Transparent" BorderBrush="Transparent" Grid.Row="2" Grid.ColumnSpan="6" Margin="0,0,0,0"
                         Padding="0,0,0,0" HorizontalContentAlignment="Stretch" x:Name="TracksListBox"
                         MouseDoubleClick="TracksDoubleClick"
                         ItemContainerStyle="{StaticResource DynamicHeightListBoxItem}" />
                        </Grid>
                    </hc:TransitioningContentControl>
                </hc:TabItem>

                <hc:TabItem Header="Artists" Background="Transparent">
                    <!-- Sayfa Gösterici -->
                    <hc:TransitioningContentControl TransitionMode="Right2LeftWithFade">
                        <Frame x:Name="MainArtistsFrame" NavigationUIVisibility="Hidden" Background="Transparent" BorderBrush="{x:Null}"/>

                    </hc:TransitioningContentControl>
                </hc:TabItem>

                <hc:TabItem Header="PlayLists" Background="Transparent">
                    <!-- Sayfa Gösterici -->
                    <hc:TransitioningContentControl TransitionMode="Right2LeftWithFade">
                    <Frame x:Name="MainPlayListsFrame" NavigationUIVisibility="Hidden" Background="Transparent" BorderBrush="{x:Null}"/>
                    </hc:TransitioningContentControl>
                </hc:TabItem>
            </hc:TabControl>
        </Grid>
    </Border>
</Page>
